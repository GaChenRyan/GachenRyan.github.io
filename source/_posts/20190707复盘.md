---
title: 20190707复盘
date: 2019-07-08 08:33:40
tags:
    - 回合制游戏
    - Python
---
## 目标
完成一个简单的PVE回合制Demo：角色在地图上点击老板娘NPC购买道具，点击战斗使者NPC进入战场。在每个回合中玩家控制己方角色防御、使用技能、使用道具，亦或是自动施法。当一方角色全部死亡时，战斗结束。

<!-- more -->

## 实现过程
1. 网络协议
使用提供的duonet协议
* GS2C：战斗开始时的角色属性、角色技能，回合开始时的回合数、角色能量值，回合结束时伤害结算信息，重连时玩家的信息，游戏结束
* C2GS：Cmd信息、法术播放结束。

2. 类
* 客户端
    * M：血条类、战场单元类、战场model类
    * V：战场场景类
    * C：战场控制类
* 服务端
    * M：角色类、阵营类、战场类
    * C：战场控制类

3. 其他
* 法术通过法术编辑器编辑
* UI通过UI编辑器编辑
* NPC、道具通过导表生成

## 有效的方法
* 信号
* print大法
* 小黄鸭调试法
* dir()

## 坑
* 引用计数
* 制订协议
* 定时器
* 变量置空
* 死亡角色处理

## 改进
* 安全规范  
没有根据安全规范来写代码，会有安全风险。
* 玩家体验  
玩家不能随便点击，像多次点击自动键。玩家的自由度不是很高。
* 商店  
    * 没有重新实现商店，商店一次只能随机购买一种道具
    * 没有实现在背包中商店的入口
